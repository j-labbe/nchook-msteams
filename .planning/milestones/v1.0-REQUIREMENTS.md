# Requirements Archive: v1.0 MVP

**Archived:** 2026-02-11
**Status:** SHIPPED

---

# Requirements: Teams Notification Interceptor

**Defined:** 2026-02-11
**Core Value:** Reliably capture every Teams message notification and deliver it as structured JSON to a webhook -- no missed messages, no noise.

## v1 Requirements

Requirements for initial release. All shipped in v1.0.

### DB Watching & Extraction

- [x] **DBWT-01**: Daemon auto-detects macOS Sequoia notification center DB path (~Library/Group Containers/group.com.apple.usernoted/db2/db)
- [x] **DBWT-02**: Daemon monitors the WAL file via kqueue (KQ_FILTER_VNODE + NOTE_WRITE) for near-instant notification detection
- [x] **DBWT-03**: Daemon falls back to periodic polling when kqueue events are missed (WAL checkpoint edge cases)
- [x] **DBWT-04**: Daemon opens notification DB in read-only mode (sqlite3 URI mode=ro) to avoid interfering with usernoted
- [x] **DBWT-05**: Daemon decodes binary plist blobs from the data column to extract notification fields (titl, subt, body, date)
- [x] **DBWT-06**: Wrapper passes subtitle (subt) as a field in the callback/webhook dispatch

### Teams Filtering

- [x] **FILT-01**: Wrapper filters notifications to Teams bundle IDs only (configurable set: com.microsoft.teams2, com.microsoft.teams)
- [x] **FILT-02**: Wrapper requires both sender (title) and body to be present and non-empty (allowlist)
- [x] **FILT-03**: Wrapper rejects notifications where title is "Microsoft Teams" (system alerts)
- [x] **FILT-04**: Wrapper rejects known noise patterns: reactions, calls, join/leave events, meeting alerts
- [x] **FILT-05**: Wrapper classifies notification type (direct_message, channel_message, mention) based on subt/title patterns

### Webhook Delivery

- [x] **WEBH-01**: Wrapper POSTs each passing notification as JSON to the configured webhook URL
- [x] **WEBH-02**: JSON payload includes: senderId, senderName, chatId, content, timestamp, _source, _truncated
- [x] **WEBH-03**: Webhook POST uses a configurable timeout (default 10s) and logs-and-skips on failure
- [x] **WEBH-04**: Wrapper detects likely truncated messages (~150 char body + no sentence-ending punctuation) and sets _truncated flag

### Configuration & State

- [x] **CONF-01**: Daemon reads JSON config file from project directory for webhook URL, bundle IDs, poll interval, log level
- [x] **CONF-02**: Daemon persists last processed rec_id to a state file using atomic writes (write-then-rename)
- [x] **CONF-03**: State file survives daemon restarts -- new session resumes from last rec_id
- [x] **CONF-04**: Daemon detects DB purge/recreation (max rec_id < persisted rec_id) and resets state with a warning

### Startup & Operations

- [x] **OPER-01**: On startup, daemon validates Full Disk Access by attempting to read the notification DB and prints actionable error if denied
- [x] **OPER-02**: On startup, daemon prints summary: DB path, FDA status, bundle IDs, webhook URL, last rec_id
- [x] **OPER-03**: Daemon handles SIGINT/SIGTERM gracefully -- flushes state to disk and exits cleanly
- [x] **OPER-04**: Daemon supports --dry-run flag that logs what would be POSTed without actually sending

## Traceability

| Requirement | Phase | Status |
|-------------|-------|--------|
| DBWT-01 | Phase 1 | Complete |
| DBWT-02 | Phase 1 | Complete |
| DBWT-03 | Phase 1 | Complete |
| DBWT-04 | Phase 1 | Complete |
| DBWT-05 | Phase 1 | Complete |
| DBWT-06 | Phase 2 | Complete |
| FILT-01 | Phase 2 | Complete |
| FILT-02 | Phase 2 | Complete |
| FILT-03 | Phase 2 | Complete |
| FILT-04 | Phase 2 | Complete |
| FILT-05 | Phase 2 | Complete |
| WEBH-01 | Phase 2 | Complete |
| WEBH-02 | Phase 2 | Complete |
| WEBH-03 | Phase 2 | Complete |
| WEBH-04 | Phase 2 | Complete |
| CONF-01 | Phase 2 | Complete |
| CONF-02 | Phase 1 | Complete |
| CONF-03 | Phase 1 | Complete |
| CONF-04 | Phase 1 | Complete |
| OPER-01 | Phase 1 | Complete |
| OPER-02 | Phase 1 | Complete |
| OPER-03 | Phase 3 | Complete |
| OPER-04 | Phase 3 | Complete |

**Coverage:**
- v1 requirements: 23 total
- Shipped: 23
- Gaps: 0

---
*Requirements defined: 2026-02-11*
*Archived: 2026-02-11 -- v1.0 MVP shipped*
